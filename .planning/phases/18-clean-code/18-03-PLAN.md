---
phase: 18-clean-code
plan: 03
type: execute
wave: 2
depends_on: ["18-01", "18-02"]
files_modified:
  - .planning/ISSUES.md
  - Multiple src/ files (docstring updates)
autonomous: true
---

<objective>
Capture all TODOs in ISSUES.md and add missing docstrings to modules.

Purpose: TODOs scattered in code are invisible. Centralize in ISSUES.md for tracking. Ensure all modules have proper documentation.

Output:
- .planning/ISSUES.md with all captured TODOs
- All modules have module-level docstrings
- All public functions have docstrings
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/18-clean-code/18-CONTEXT.md
</context>

<tasks>
<task type="auto">
  <name>Task 1: Create ISSUES.md with all TODOs from codebase</name>
  <files>.planning/ISSUES.md</files>
  <action>
1. Search for all TODOs:
   ```bash
   grep -rn "TODO\|FIXME\|XXX\|HACK" src/ --include="*.py"
   ```

2. Create `.planning/ISSUES.md`:
```markdown
# Known Issues and TODOs

Captured from codebase during Phase 18 (Clean Code).

## Open Issues

### Session/Epic Features (Deferred)

| ID | Source | Description | Status |
|----|--------|-------------|--------|
| ISS-001 | handlers:1001 | Route to session creation | Deferred |
| ISS-002 | handlers:1008 | Implement Jira search | Completed (Phase 7) |
| ISS-003 | handlers:1012 | Query session status | Deferred |
| ISS-004 | handlers:1252 | Update session card with linked thread reference | Deferred |
| ISS-005 | handlers:1253 | Update Epic summary with cross-reference | Deferred |
| ISS-006 | binding:61,148 | Fetch epic_summary from Jira | Deferred |

### Constraint/Contradiction Features (Deferred)

| ID | Source | Description | Status |
|----|--------|-------------|--------|
| ISS-007 | handlers:1290 | Update constraint status to 'conflicted' in KG | Deferred |
| ISS-008 | handlers:1291 | Add to Epic summary as unresolved conflict | Deferred |
| ISS-009 | handlers:1316 | Mark old constraint as 'deprecated' | Deferred |
| ISS-010 | handlers:1317 | Mark new constraint as 'accepted' | Deferred |
| ISS-011 | handlers:1342 | Mark both as 'accepted' with note | Deferred |

## Resolved Issues

| ID | Description | Resolution | Phase |
|----|-------------|------------|-------|
| - | Jira search implementation | Implemented | Phase 7 |
| - | Intent detection for review vs ticket | Implemented | Phase 13 |

## Notes

- Session and Epic features were part of original design but deprioritized for v1.0
- Constraint/contradiction features relate to knowledge graph updates (not yet implemented)
- These issues are tracked here for future reference; no immediate action required

---

*Last updated: 2026-01-15 (Phase 18)*
```

3. Remove or comment out the TODO comments in source files, replacing with:
   ```python
   # See .planning/ISSUES.md ISS-XXX
   ```
  </action>
  <verify>cat .planning/ISSUES.md | head -30</verify>
  <done>ISSUES.md created with all captured TODOs</done>
</task>

<task type="auto">
  <name>Task 2: Audit and add missing module docstrings</name>
  <files>Multiple src/ files</files>
  <action>
1. Find modules without docstrings:
   ```bash
   for f in $(find src -name "*.py" -not -path "*/__pycache__/*"); do
     first_line=$(head -1 "$f")
     if [[ ! "$first_line" =~ ^\"\"\" ]]; then
       echo "Missing docstring: $f"
     fi
   done
   ```

2. Add module docstrings to files that are missing them. Format:
   ```python
   """Brief one-line description.

   Longer description if needed, explaining:
   - Purpose of this module
   - Key classes/functions
   - Usage notes
   """
   ```

3. Priority files to check:
   - All __init__.py files
   - All new handler modules from 18-01
   - All new block modules from 18-02
   - src/graph/nodes/*.py
   - src/db/*.py
   - src/skills/*.py

4. Ensure each module docstring mentions:
   - What the module does (1 line)
   - Key exports (if package __init__.py)
   - Phase it was created/modified in (optional but helpful)
  </action>
  <verify>for f in src/slack/handlers/*.py src/slack/blocks/*.py; do head -3 "$f"; echo "---"; done</verify>
  <done>All modules have docstrings</done>
</task>

<task type="auto">
  <name>Task 3: Verify public functions have docstrings</name>
  <files>Multiple src/ files</files>
  <action>
1. Focus on key public modules:
   - src/slack/handlers/*.py (new modules)
   - src/slack/blocks/*.py (new modules)
   - src/graph/intent.py
   - src/graph/graph.py
   - src/jira/client.py

2. For each public function (not starting with _), ensure it has a docstring:
   - Brief description
   - Args (if parameters exist)
   - Returns (if returns something)
   - Raises (if raises exceptions)

3. Use grep to find functions without docstrings:
   ```bash
   # Find public functions
   grep -n "^def [^_]" src/slack/handlers/*.py
   # Then check if next line is docstring
   ```

4. Add minimal docstrings where missing. Format:
   ```python
   def handle_something(ack, body, client):
       """Handle something action from Slack.

       Args:
           ack: Bolt acknowledgement function
           body: Request body from Slack
           client: Slack WebClient
       """
   ```
  </action>
  <verify>python -c "import src.slack.handlers; import src.slack.blocks; print('OK')"</verify>
  <done>Public functions have docstrings</done>
</task>

<task type="auto">
  <name>Task 4: Final verification and line count check</name>
  <files>None (verification only)</files>
  <action>
1. Verify no file exceeds 600 lines:
   ```bash
   find src -name "*.py" -exec wc -l {} \; | awk '$1 > 600 {print}'
   ```
   Expected: No output (all files under 600 lines)

2. Verify all imports work:
   ```bash
   python -c "
   import src.slack.handlers
   import src.slack.blocks
   import src.graph.intent
   import src.graph.graph
   import src.jira.client
   import src.db
   import src.skills
   print('All imports OK')
   "
   ```

3. Run existing tests to ensure nothing broke:
   ```bash
   python -m pytest tests/ -x --tb=short 2>&1 | tail -20
   ```

4. Document final stats:
   - Total Python files
   - Largest file and its line count
   - Number of modules with docstrings
  </action>
  <verify>find src -name "*.py" -exec wc -l {} \; | awk '$1 > 600 {print "FAIL: " $0; exit 1}'</verify>
  <done>All files under 600 lines, all imports work, tests pass</done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] .planning/ISSUES.md exists with all TODOs captured
- [ ] `find src -name "*.py" -exec wc -l {} \; | awk '$1 > 600'` returns empty
- [ ] All module-level docstrings present
- [ ] `python -m pytest tests/ -x` passes
</verification>

<success_criteria>
- ISSUES.md captures all known TODOs
- No Python file exceeds 600 lines
- All modules have docstrings
- All tests pass
- Codebase follows clean code principles
</success_criteria>

<output>
After completion, create `.planning/phases/18-clean-code/18-03-SUMMARY.md`
</output>
