---
phase: 11.2-progress-status-indicators
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/slack/progress.py, src/slack/handlers.py]
autonomous: true
---

<objective>
Create ProgressTracker module and integrate into main handler for status messaging.

Purpose: Provide visual feedback during bot processing with timing-based thresholds.
Output: Working status indicator that appears when operations take >4 seconds.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11.2-progress-status-indicators/11.2-CONTEXT.md

@src/slack/handlers.py
@src/slack/session.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProgressTracker module</name>
  <files>src/slack/progress.py</files>
  <action>
Create a ProgressTracker class that manages status messages with timing thresholds.

Key features:
- Track operation start time
- Post status message only if operation takes >4 seconds
- Update same message (don't post new ones)
- Delete status message after result is posted
- Support skill-specific status text

Class structure:
```python
class ProgressTracker:
    """Manage progress status messages with timing thresholds."""

    def __init__(self, client: AsyncWebClient, channel: str, thread_ts: str):
        self.client = client
        self.channel = channel
        self.thread_ts = thread_ts
        self._status_ts: str | None = None
        self._start_time: float | None = None
        self._current_status: str = ""

    async def start(self, initial_status: str = "Processing..."):
        """Start tracking. Posts status if >4s threshold exceeded."""

    async def update(self, status: str):
        """Update status text. Only posts if message already visible."""

    async def complete(self, show_done: bool = True):
        """Mark complete. Edits to Done, then deletes after 1s."""

    async def _post_status(self):
        """Post initial status message."""

    async def _update_status(self):
        """Update existing status message with elapsed time."""

    async def _delete_status(self):
        """Delete status message."""
```

Timing logic:
- Don't post immediately on start()
- Use asyncio.create_task() to schedule delayed posting
- Check elapsed time when update() called
- If elapsed > 4s and no message yet, post it

Message format (minimal with emoji prefix):
- "⏳ Processing..."
- "⏳ Searching Jira... (5s)"
- "✅ Done."

Export ProgressTracker from package.
  </action>
  <verify>python -c "from src.slack.progress import ProgressTracker; print('OK')"</verify>
  <done>ProgressTracker class exists with start/update/complete methods</done>
</task>

<task type="auto">
  <name>Task 2: Integrate ProgressTracker into main handler</name>
  <files>src/slack/handlers.py</files>
  <action>
Integrate ProgressTracker into _process_mention() and _process_thread_message().

In _process_mention():
1. Create ProgressTracker after identity is established
2. Call tracker.start("Processing...") before graph execution
3. Call tracker.complete() after result is dispatched

In _process_thread_message():
1. Same pattern as _process_mention()

Example integration:
```python
async def _process_mention(...):
    # ... existing setup code ...

    # Create progress tracker
    from src.slack.progress import ProgressTracker
    tracker = ProgressTracker(client, channel, thread_ts)

    try:
        await tracker.start("Processing...")

        # ... existing graph execution ...
        result = await runner.run_with_message(...)

        # Update status before dispatching
        if result.get("action") == "preview":
            await tracker.update("Preparing preview...")

        # ... dispatch result ...

    finally:
        await tracker.complete()
```

Keep it simple - don't add status updates to every operation yet.
Just track the overall request processing time.
  </action>
  <verify>Run bot, send message, observe status appears for operations >4s</verify>
  <done>ProgressTracker integrated into main handler flow</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ProgressTracker module imports without errors
- [ ] Status message appears when operation takes >4 seconds
- [ ] Status message is deleted after result is posted
- [ ] No status noise for fast operations (<4s)
</verification>

<success_criteria>
- All tasks completed
- ProgressTracker provides timing-based status feedback
- Handler integration is minimal and non-invasive
</success_criteria>

<output>
After completion, create `.planning/phases/11.2-progress-status-indicators/11.2-01-SUMMARY.md`
</output>
