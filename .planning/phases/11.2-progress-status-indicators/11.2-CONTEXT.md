# Phase 11.2: Progress & Status Indicators - Context

**Gathered:** 2026-01-15
**Status:** Ready for planning

<vision>
## How This Should Work

MARO behaves like a calm system operator: states what's happening, retries deterministically, reports progress, and escalates when automation is exhausted.

**Core principle:** No channel spam. No debug output. No "trying too hard." Just clear, minimal signals that the bot is alive and working.

**Timing-based behavior:**

| Time | Behavior |
|------|----------|
| < 1.5s | Only the final response |
| 1.5‚Äì4s | Typing indicator only |
| > 4s | One-line status message + typing |
| > 15s | Status with bottleneck info, update at 30s |

**Status message flow:**
1. Post status message when operation starts (if > 4s)
2. Update same message as steps progress
3. Edit to "Done" when complete
4. Delete status message after result is posted

**Sequential operations:** One status message, update text as steps change:
- "Extracting..." ‚Üí "Validating..." ‚Üí "Done"

**Skill-specific messages:** Each skill has its own status text:
- `jira_search`: "Searching Jira..."
- `preview_ticket`: "Preparing preview..."
- `jira_create`: "Creating ticket..."

</vision>

<essential>
## What Must Be Nailed

- **Timing thresholds right** ‚Äî 1.5s / 4s / 15s boundaries feel natural, not jumpy
- **Calm professional tone** ‚Äî Single status message that doesn't feel like debug output
- **No channel noise** ‚Äî Never pollute thread with internal pipeline steps
- **All equally important** ‚Äî These three aspects are inseparable

</essential>

<specifics>
## Specific Ideas

### Visual Style
- Minimal with emoji prefix: "‚è≥ Working..." / "‚úÖ Done" / "‚ùå Failed"
- Short, clean messages ‚Äî no sentences, no personality

### Error Handling Protocol
MARO as system operator: state the failure, retry deterministically, report progress, escalate when automation is exhausted.

**4 error classes:**

1. **External API errors** (Slack, Jira, Zep)
   - Immediate notification
   - Auto-retry with exponential backoff (5s, 15s, 45s)
   - Show attempt count: "‚ö†Ô∏è Jira API error (timeout). Retrying‚Ä¶ (1/3)"
   - After max retries: action buttons [Retry] [Skip] [Cancel]

2. **Validation/logical errors** (incomplete draft, conflicts)
   - No retry ‚Äî needs human decision
   - "‚õî Cannot proceed: Draft was changed after approval"

3. **LLM/inference errors** (timeout, parsing error)
   - Auto-retry 1-2 times with short delay (2s, 5s)
   - "‚ö†Ô∏è Reasoning engine failed. Retry or use simplified mode?"

4. **Internal state errors** (corrupted state, missing bindings)
   - Most serious ‚Äî honest acknowledgment
   - "‚ùå Internal state inconsistency. Session cannot continue safely."
   - Options: [Reset session] [Export context] [Cancel]

### Long Operations (15+ seconds)
- Post bottleneck-specific wait message once
- Update at ~30 seconds with elapsed time and attempt count
- Example: "‚è≥ Jira is responding slowly (30s). Attempt 2/3‚Ä¶"
- Never periodic heartbeats ‚Äî channels hate bot drip

### Draft State Indicators
- State badge in preview message header
- "üü° Draft" / "üü¢ Approved" / "‚úÖ Created"

### Message Cleanup
- Reuse single `status_message_ts` ‚Äî edit, never post new
- After completion: edit to "‚úÖ Done", then delete after 1-2 seconds
- Clean thread ‚Äî only final response remains

### Retry Policy

| Error Type | Retry | Delay | Max Attempts |
|------------|-------|-------|--------------|
| External API | Yes | Exp backoff (5s, 15s, 45s) | 3 |
| LLM | Yes | Short (2s, 5s) | 2 |
| Validation | No | ‚Äî | 0 |
| Internal state | No | ‚Äî | 0 |

</specifics>

<notes>
## Additional Context

**Key philosophy:** MARO never blames the user and never makes excuses. It simply states: what failed, what it's doing, what it needs from the human.

**What this is NOT:**
- Not a progress bar (looks artificial in Slack)
- Not live pipeline updates (noisy, shows internal architecture)
- Not just typing indicator (users think bot died on long operations)

**Implementation hint:** Create `status_message_ts` and reuse it. Include: service name, elapsed time bucket, attempt count.

**Example messages (copy-ready):**
- ‚è≥ Jira API is responding slowly (15s). Still waiting‚Ä¶
- ‚è≥ Slack API rate-limited (429). Backing off 20s‚Ä¶
- ‚è≥ LLM timed out. Retrying in 5s (1/2)‚Ä¶
- ‚úÖ Done.
- ‚ùå Jira still unreachable after 3 attempts.

</notes>

---

*Phase: 11.2-progress-status-indicators*
*Context gathered: 2026-01-15*
