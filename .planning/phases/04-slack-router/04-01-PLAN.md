---
phase: 04-slack-router
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/slack/__init__.py, src/slack/app.py, src/config/settings.py, pyproject.toml]
autonomous: true
---

<objective>
Set up Slack Bolt application with Socket Mode for development.

Purpose: Foundation for all Slack interactions - reliable event handling without public URL.
Output: Working Slack app that connects and receives events.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-slack-router/04-CONTEXT.md

Prior phases provide:
- Settings pattern (src/config/settings.py)
- Package structure (src layout)

Key decisions from CONTEXT:
- Socket Mode for development (no public URL needed)
- Ack immediately, enqueue work pattern
- Ignore message subtypes (edited, bot messages)

@src/config/settings.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Slack dependencies</name>
  <files>pyproject.toml</files>
  <action>
Add to dependencies:
- "slack-bolt>=1.18"
- "slack-sdk>=3.21"

These come together but explicit is better.
  </action>
  <verify>pip install -e . && python -c "from slack_bolt import App; print('slack-bolt ok')"</verify>
  <done>slack-bolt and slack-sdk installed</done>
</task>

<task type="auto">
  <name>Task 2: Add Slack settings</name>
  <files>src/config/settings.py</files>
  <action>
Add to Settings class:
```python
# Slack
slack_bot_token: str  # xoxb-...
slack_app_token: str  # xapp-... (for Socket Mode)
slack_signing_secret: Optional[str] = None  # For HTTP mode (future)
```

Both tokens required for Socket Mode operation.
  </action>
  <verify>python -c "from src.config import get_settings; s = get_settings(); print('slack_bot_token' in dir(s))"</verify>
  <done>Slack tokens in settings</done>
</task>

<task type="auto">
  <name>Task 3: Create Slack app with Socket Mode</name>
  <files>src/slack/app.py, src/slack/__init__.py</files>
  <action>
Create src/slack/app.py:

```python
"""Slack Bolt application with Socket Mode."""

import logging
from slack_bolt import App
from slack_bolt.adapter.socket_mode import SocketModeHandler

from src.config import get_settings

logger = logging.getLogger(__name__)

_app: App | None = None
_handler: SocketModeHandler | None = None

def get_slack_app() -> App:
    """Get or create the Slack Bolt app singleton."""
    global _app
    if _app is None:
        settings = get_settings()
        _app = App(
            token=settings.slack_bot_token,
            signing_secret=settings.slack_signing_secret,
        )
        logger.info("Slack app initialized")
    return _app

def start_socket_mode():
    """Start Socket Mode handler (blocking)."""
    global _handler
    settings = get_settings()
    app = get_slack_app()

    _handler = SocketModeHandler(app, settings.slack_app_token)
    logger.info("Starting Socket Mode...")
    _handler.start()

def stop_socket_mode():
    """Stop Socket Mode handler."""
    global _handler
    if _handler:
        _handler.close()
        _handler = None
        logger.info("Socket Mode stopped")
```

Create src/slack/__init__.py with exports:
- get_slack_app
- start_socket_mode
- stop_socket_mode
  </action>
  <verify>python -c "from src.slack import get_slack_app; print('slack app module ok')"</verify>
  <done>Slack app singleton with Socket Mode lifecycle</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pip install -e .` succeeds with slack-bolt
- [ ] `python -c "from src.slack import get_slack_app"` succeeds
- [ ] Settings has slack_bot_token and slack_app_token
- [ ] No import errors
</verification>

<success_criteria>

- All tasks completed
- Slack Bolt app can be instantiated
- Socket Mode handler available
- Settings accept required tokens
</success_criteria>

<output>
After completion, create `.planning/phases/04-slack-router/04-01-SUMMARY.md`
</output>
