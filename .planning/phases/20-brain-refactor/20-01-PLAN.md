---
phase: 20-brain-refactor
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/schemas/state.py
  - src/graph/types.py
autonomous: true
---

<objective>
Define new state types for brain refactor: UserIntent, PendingAction, WorkflowStep, WorkflowEventType enums.

Purpose: Foundation types that all other Phase 20 plans depend on. Separates user intent from workflow state.
Output: New enums and TypedDicts in state.py, clean imports available.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-brain-refactor/20-CONTEXT.md
@src/schemas/state.py
</context>

<tasks>
<task type="auto">
  <name>Task 1: Add UserIntent enum</name>
  <files>src/schemas/state.py</files>
  <action>
Add new UserIntent enum with pure user intents only (NOT workflow events):

```python
class UserIntent(str, Enum):
    """Pure user intent - what the user wants, not workflow state."""
    TICKET = "ticket"           # Create a Jira ticket
    REVIEW = "review"           # Analysis/feedback without Jira
    DISCUSSION = "discussion"   # Casual greeting, simple question
    META = "meta"               # Questions about the bot itself
    AMBIGUOUS = "ambiguous"     # Unclear intent, triggers scope gate
```

This is DIFFERENT from current IntentType in intent.py which mixes user intent with workflow events (DECISION_APPROVAL, REVIEW_CONTINUATION, TICKET_ACTION). Those will become PendingAction values in Wave 2.

Place after existing enums (AgentPhase, ReviewState).
  </action>
  <verify>python -c "from src.schemas.state import UserIntent; print(list(UserIntent))"</verify>
  <done>UserIntent enum exists with 5 values: TICKET, REVIEW, DISCUSSION, META, AMBIGUOUS</done>
</task>

<task type="auto">
  <name>Task 2: Add PendingAction enum</name>
  <files>src/schemas/state.py</files>
  <action>
Add PendingAction enum for resumable workflow state:

```python
class PendingAction(str, Enum):
    """What the workflow is waiting for (resumable state)."""
    WAITING_APPROVAL = "waiting_approval"           # Draft preview shown, waiting approve/reject
    WAITING_SCOPE_CHOICE = "waiting_scope_choice"   # Scope gate shown, waiting user choice
    WAITING_STORY_EDIT = "waiting_story_edit"       # Multi-ticket preview, waiting story edit
    WAITING_DECISION_EDIT = "waiting_decision_edit" # Decision preview, waiting edit
    WAITING_QUANTITY_CONFIRM = "waiting_quantity_confirm"  # Multi-ticket >3 items, confirm
    WAITING_SIZE_CONFIRM = "waiting_size_confirm"   # Multi-ticket large batch, confirm split
```

This replaces overloaded IntentType values (DECISION_APPROVAL becomes a PendingAction).
  </action>
  <verify>python -c "from src.schemas.state import PendingAction; print(list(PendingAction))"</verify>
  <done>PendingAction enum exists with 6 workflow states</done>
</task>

<task type="auto">
  <name>Task 3: Add WorkflowStep and WorkflowEventType enums</name>
  <files>src/schemas/state.py</files>
  <action>
Add WorkflowStep enum (typed workflow positions, not strings):

```python
class WorkflowStep(str, Enum):
    """Typed workflow positions for event validation."""
    DRAFT_PREVIEW = "draft_preview"
    MULTI_TICKET_PREVIEW = "multi_ticket_preview"
    DECISION_PREVIEW = "decision_preview"
    REVIEW_ACTIVE = "review_active"
    REVIEW_FROZEN = "review_frozen"
    SCOPE_GATE = "scope_gate"
```

Add WorkflowEventType enum:

```python
class WorkflowEventType(str, Enum):
    """Types of workflow events (buttons, commands, modals)."""
    BUTTON_CLICK = "button_click"
    SLASH_COMMAND = "slash_command"
    MODAL_SUBMIT = "modal_submit"
```

These are used for event validation - each WorkflowStep has allowed events.
  </action>
  <verify>python -c "from src.schemas.state import WorkflowStep, WorkflowEventType; print(list(WorkflowStep)); print(list(WorkflowEventType))"</verify>
  <done>WorkflowStep (6 values) and WorkflowEventType (3 values) enums exist</done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from src.schemas.state import UserIntent, PendingAction, WorkflowStep, WorkflowEventType"` succeeds
- [ ] All 4 enums are properly typed (str, Enum)
- [ ] Existing AgentState and other enums still work
- [ ] `python -m pytest tests/ -x --tb=short` passes (no regressions)
</verification>

<success_criteria>
- 4 new enums defined: UserIntent, PendingAction, WorkflowStep, WorkflowEventType
- Clear separation between user intent (UserIntent) and workflow state (PendingAction)
- Types are importable from src.schemas.state
- No breaking changes to existing code
</success_criteria>

<output>
After completion, create `.planning/phases/20-brain-refactor/20-01-SUMMARY.md`
</output>
