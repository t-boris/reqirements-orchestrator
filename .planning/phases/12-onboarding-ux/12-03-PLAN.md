---
phase: 12-onboarding-ux
plan: 03
type: execute
wave: 2
depends_on: ["12-01", "12-02"]
files_modified: [src/slack/handlers.py, src/slack/blocks.py, src/slack/modals.py, src/slack/router.py]
autonomous: true
---

<objective>
Implement interactive /maro help command with example conversations.

Purpose: Make help actionable - click a button, see an example conversation demonstrating that feature. Not documentation, demonstrations.
Output: /maro help shows capabilities with buttons that open example exchanges.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-onboarding-ux/12-CONTEXT.md

@src/slack/handlers.py (_handle_maro_command_async)
@src/slack/blocks.py
@src/slack/modals.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create help example data</name>
  <files>src/slack/onboarding.py</files>
  <action>
Add help examples to the onboarding module.

Append to src/slack/onboarding.py:

```python
# Example conversations for interactive help
HELP_EXAMPLES = {
    "create_ticket": {
        "title": "Create Ticket",
        "short_desc": "Draft Jira tickets from discussion",
        "conversation": [
            {"role": "user", "text": "@MARO We need a way for users to export their data to CSV format"},
            {"role": "bot", "text": "Got it. A few questions to shape this into a ticket:\n\n1. What data should be exportable?\n2. Should there be any format options besides CSV?\n3. Who should have access to this feature?"},
            {"role": "user", "text": "All their account data - profile, settings, activity history. Just CSV for now. All users."},
            {"role": "bot", "text": "*Preview: Export User Data to CSV*\n\n*Problem:* Users need to export their account data...\n\n[Approve] [Edit]"},
        ],
    },
    "review": {
        "title": "Review",
        "short_desc": "Get architecture or security review",
        "conversation": [
            {"role": "user", "text": "@MARO Review this as security"},
            {"role": "bot", "text": "Switched to Security perspective.\n\nI'll review for: authentication, authorization, data validation, injection risks, secrets handling.\n\nWhat would you like me to review?"},
            {"role": "user", "text": "We're adding a file upload feature for user avatars"},
            {"role": "bot", "text": "*Security Review: Avatar Upload*\n\n:warning: *Risks identified:*\n• File type validation (accept only images)\n• File size limits (prevent DoS)\n• Filename sanitization\n• Storage location (not in webroot)\n\n*Recommendations:*\n• Validate MIME type server-side\n• Resize images to max dimensions\n• Generate random filenames"},
        ],
    },
    "settings": {
        "title": "Settings",
        "short_desc": "Channel listening and preferences",
        "conversation": [
            {"role": "user", "text": "/maro status"},
            {"role": "bot", "text": "*MARO Listening Status:* Disabled\n\nUse `/maro enable` to start listening in this channel."},
            {"role": "user", "text": "/maro enable"},
            {"role": "bot", "text": "MARO is now listening in this channel to maintain context. It won't reply unless mentioned or commanded."},
        ],
    },
}


def get_help_blocks() -> list[dict]:
    """Build interactive help message with action buttons.

    Short, structured, action-oriented.
    Clicking a button shows example conversation.
    """
    blocks = [
        {
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": "*What MARO can do:*\n• Draft Jira tickets from discussion\n• Propose architecture + risks\n• Detect duplicates\n• Sync with Jira\n• Track channel context"
            }
        },
        {
            "type": "actions",
            "elements": [
                {
                    "type": "button",
                    "text": {"type": "plain_text", "text": "Create Ticket", "emoji": True},
                    "action_id": "help_example_create_ticket",
                    "value": "create_ticket",
                },
                {
                    "type": "button",
                    "text": {"type": "plain_text", "text": "Review", "emoji": True},
                    "action_id": "help_example_review",
                    "value": "review",
                },
                {
                    "type": "button",
                    "text": {"type": "plain_text", "text": "Settings", "emoji": True},
                    "action_id": "help_example_settings",
                    "value": "settings",
                },
            ]
        },
        {
            "type": "context",
            "elements": [
                {
                    "type": "mrkdwn",
                    "text": "Click a button to see an example conversation"
                }
            ]
        }
    ]
    return blocks


def get_example_blocks(example_key: str) -> list[dict]:
    """Build blocks showing an example conversation.

    Args:
        example_key: Key from HELP_EXAMPLES dict

    Returns:
        Slack blocks with example conversation
    """
    example = HELP_EXAMPLES.get(example_key)
    if not example:
        return [{"type": "section", "text": {"type": "mrkdwn", "text": "Example not found."}}]

    blocks = [
        {
            "type": "header",
            "text": {"type": "plain_text", "text": f"Example: {example['title']}", "emoji": True}
        }
    ]

    # Build conversation blocks
    for turn in example["conversation"]:
        if turn["role"] == "user":
            prefix = ":bust_in_silhouette: *You:*"
        else:
            prefix = ":robot_face: *MARO:*"

        blocks.append({
            "type": "section",
            "text": {
                "type": "mrkdwn",
                "text": f"{prefix}\n{turn['text']}"
            }
        })
        blocks.append({"type": "divider"})

    # Remove last divider
    if blocks and blocks[-1].get("type") == "divider":
        blocks.pop()

    return blocks
```
  </action>
  <verify>python -c "from src.slack.onboarding import get_help_blocks, HELP_EXAMPLES; print(len(HELP_EXAMPLES))"</verify>
  <done>Help examples and block builders created</done>
</task>

<task type="auto">
  <name>Task 2: Update /maro help subcommand</name>
  <files>src/slack/handlers.py</files>
  <action>
Update `_handle_maro_command_async` to show interactive help.

Find the else block that handles unknown subcommands and update to handle "help" explicitly:

```python
async def _handle_maro_command_async(command: dict, say, client: WebClient):
    """Async implementation of /maro slash command.

    Subcommands:
    - /maro enable - Enable listening in channel
    - /maro disable - Disable listening in channel
    - /maro status - Show current listening state
    - /maro help - Interactive help with examples
    """
    channel = command.get("channel_id")
    team_id = command.get("team_id", "")
    user_id = command.get("user_id")
    text = command.get("text", "").strip().lower()

    logger.info(
        "MARO command received",
        extra={
            "channel": channel,
            "team_id": team_id,
            "user_id": user_id,
            "subcommand": text,
        }
    )

    if text == "enable":
        await _handle_maro_enable(team_id, channel, user_id, say)
    elif text == "disable":
        await _handle_maro_disable(team_id, channel, say)
    elif text == "status":
        await _handle_maro_status(team_id, channel, say)
    elif text == "help":
        await _handle_maro_help(channel, client)
    else:
        # Default to help for empty or unknown
        await _handle_maro_help(channel, client)


async def _handle_maro_help(channel: str, client: WebClient):
    """Handle /maro help - show interactive help with example buttons."""
    from src.slack.onboarding import get_help_blocks

    blocks = get_help_blocks()

    client.chat_postMessage(
        channel=channel,
        text="What MARO can do",
        blocks=blocks,
    )
```

Replace the existing else block usage text with the interactive help.
  </action>
  <verify>python -c "from src.slack.handlers import _handle_maro_command_async; print('OK')"</verify>
  <done>/maro help shows interactive help with buttons</done>
</task>

<task type="auto">
  <name>Task 3: Add help example button handlers</name>
  <files>src/slack/router.py, src/slack/handlers.py</files>
  <action>
Add handlers for help example button clicks.

In router.py, add action registration after the hint handlers:
```python
# Help example buttons (Phase 12 onboarding)
app.action(re.compile(r"^help_example_.*"))(handle_help_example)
```

Import handle_help_example in router.py imports.

In handlers.py, add handler:
```python
def handle_help_example(ack, body, client: WebClient, action):
    """Handle help example button click.

    Shows example conversation for the selected feature.
    """
    ack()

    channel = body["channel"]["id"]
    user_id = body["user"]["id"]

    # Get example key from action_id (help_example_create_ticket -> create_ticket)
    action_id = action.get("action_id", "")
    example_key = action_id.replace("help_example_", "")

    logger.info(
        "Help example requested",
        extra={
            "channel": channel,
            "example_key": example_key,
            "user_id": user_id,
        }
    )

    from src.slack.onboarding import get_example_blocks

    blocks = get_example_blocks(example_key)

    # Post example as ephemeral message (only visible to user who clicked)
    try:
        client.chat_postEphemeral(
            channel=channel,
            user=user_id,
            text=f"Example: {example_key.replace('_', ' ').title()}",
            blocks=blocks,
        )
    except Exception as e:
        logger.warning(f"Failed to post ephemeral example: {e}")
        # Fall back to regular message
        client.chat_postMessage(
            channel=channel,
            text=f"Example: {example_key.replace('_', ' ').title()}",
            blocks=blocks,
        )
```
  </action>
  <verify>python -c "from src.slack.handlers import handle_help_example; print('OK')"</verify>
  <done>Help example button handlers show example conversations</done>
</task>

<task type="auto">
  <name>Task 4: Update existing /help command to redirect</name>
  <files>src/slack/handlers.py</files>
  <action>
Update the existing `handle_help_command` to show the interactive help instead of static text.

Replace the current implementation:

```python
def handle_help_command(ack: Ack, command: dict, say, client: WebClient):
    """Handle /help slash command - redirect to interactive /maro help."""
    ack()

    channel = command.get("channel_id")

    # Use the interactive help
    _run_async(_handle_maro_help(channel, client))
```

This keeps /help working but now shows the interactive version.
  </action>
  <verify>python -c "from src.slack.handlers import handle_help_command; print('OK')"</verify>
  <done>/help redirects to interactive help</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `/maro help` shows interactive help with 3 buttons
- [ ] `/maro` (no subcommand) shows interactive help
- [ ] `/help` shows interactive help
- [ ] Clicking "Create Ticket" shows example conversation (ephemeral)
- [ ] Clicking "Review" shows security review example
- [ ] Clicking "Settings" shows enable/status examples
- [ ] Examples are ephemeral (only visible to clicking user)
</verification>

<success_criteria>
- All tasks completed
- Help is interactive with buttons
- Examples show realistic conversations
- Ephemeral messages don't spam channel
</success_criteria>

<output>
After completion, create `.planning/phases/12-onboarding-ux/12-03-SUMMARY.md`
</output>
