---
phase: 02-database-layer
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [src/db/checkpointer.py, src/db/__init__.py]
autonomous: true
---

<objective>
Integrate LangGraph PostgreSQL checkpointer for agent state persistence.

Purpose: Enable resumable agent sessions by persisting LangGraph state to PostgreSQL.
Output: PostgresSaver checkpointer configured and ready for agent graph.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

Prior work:
- 02-01 establishes database connection utilities
- Settings has database_url

Reference: 02-01-PLAN.md establishes connection module

@src/config/settings.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create checkpointer module with PostgresSaver</name>
  <files>src/db/checkpointer.py</files>
  <action>
Create LangGraph checkpointer using PostgresSaver from langgraph-checkpoint-postgres.

Implementation:
1. Import PostgresSaver from langgraph.checkpoint.postgres
2. Create get_checkpointer() function that returns configured PostgresSaver
3. Use sync connection (PostgresSaver uses psycopg sync mode)
4. Create setup_checkpointer() to initialize tables (call once)

Note: langgraph-checkpoint-postgres uses psycopg (v3) internally with sync connections.
PostgresSaver.from_conn_string(database_url) is the standard pattern.

The checkpointer needs to call .setup() once to create its tables.

Connection string from get_settings().database_url
  </action>
  <verify>python -c "from src.db.checkpointer import get_checkpointer, setup_checkpointer; print('imports ok')"</verify>
  <done>Checkpointer module exports get_checkpointer(), setup_checkpointer()</done>
</task>

<task type="auto">
  <name>Task 2: Add langgraph-checkpoint-postgres dependency</name>
  <files>pyproject.toml</files>
  <action>
Add langgraph-checkpoint-postgres to dependencies:
- "langgraph-checkpoint-postgres>=2.0"

This provides PostgresSaver for LangGraph state persistence.
  </action>
  <verify>pip install -e . && python -c "from langgraph.checkpoint.postgres import PostgresSaver; print('checkpointer available')"</verify>
  <done>PostgresSaver importable from langgraph.checkpoint.postgres</done>
</task>

<task type="auto">
  <name>Task 3: Update db package exports</name>
  <files>src/db/__init__.py</files>
  <action>
Add checkpointer exports to src/db/__init__.py:
- get_checkpointer
- setup_checkpointer

Keep existing exports from 02-01 (get_connection, init_db, close_db).
  </action>
  <verify>python -c "from src.db import get_checkpointer, setup_checkpointer; print('exports ok')"</verify>
  <done>Checkpointer functions available from src.db</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pip install -e .` succeeds
- [ ] `python -c "from src.db import get_checkpointer, setup_checkpointer"` succeeds
- [ ] PostgresSaver importable
- [ ] No import errors
</verification>

<success_criteria>

- All tasks completed
- LangGraph checkpointer configured for PostgreSQL
- Checkpointer ready to be passed to compiled graph
- Clean imports from src.db
</success_criteria>

<output>
After completion, create `.planning/phases/02-database-layer/02-02-SUMMARY.md`
</output>
