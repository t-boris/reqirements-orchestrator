---
phase: 21-jira-sync
plan: 02
type: execute
wave: 1
depends_on: [21-01]
files_modified: [src/slack/pinned_board.py, src/slack/handlers/commands.py, src/slack/router.py]
autonomous: true
---

<objective>
Create pinned board dashboard for tracked issues.

Purpose: Visible dashboard in channel showing all tracked Jira issues with current status.
Output: /maro board command that posts/updates a pinned message with issue summary.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-jira-sync/21-CONTEXT.md

@src/slack/channel_tracker.py (from 21-01)
@src/slack/handlers/commands.py
@src/jira/client.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PinnedBoardManager</name>
  <files>src/slack/pinned_board.py</files>
  <action>
Create PinnedBoardManager class that manages the pinned Jira board message per channel.

Class: PinnedBoardManager
- channel_id: str
- message_ts: Optional[str] (tracks the pinned message)

Methods:
- build_board_blocks(issues: list[TrackedIssue]) -> list[dict]
  Build Slack blocks showing:
  ```
  ðŸ“‹ *Jira Issues Tracked in #channel*
  Updated: Jan 16, 2026 at 3:45 PM

  *Open (3)*
  â€¢ SCRUM-123: User authentication flow - @john
  â€¢ SCRUM-124: Database migration - @sarah
  â€¢ SCRUM-125: API documentation - Unassigned

  *In Progress (2)*
  â€¢ SCRUM-126: Frontend refactor - @mike
  â€¢ SCRUM-127: Testing framework - @anna

  *Done (1)*
  â€¢ SCRUM-128: Setup CI/CD âœ“
  ```

- post_or_update(client, channel_id) -> str
  1. Get tracked issues from ChannelIssueTracker
  2. Fetch current status from Jira for each
  3. Build blocks
  4. If message_ts exists, update message; else post new
  5. Pin the message if newly posted
  6. Return message_ts

- unpin(client, channel_id) -> bool
  Unpin and delete the board message

Store message_ts in PostgreSQL (add board_message_ts to channel tracking or create separate table).
  </action>
  <verify>PinnedBoardManager imports without errors</verify>
  <done>PinnedBoardManager creates/updates pinned board blocks</done>
</task>

<task type="auto">
  <name>Task 2: Add /maro board command</name>
  <files>src/slack/handlers/commands.py</files>
  <action>
Add board subcommand to /maro:
- `/maro board` - Post/update the pinned board for this channel
- `/maro board hide` - Unpin and remove the board

In _handle_maro_command_async:
1. Parse "board" subcommand
2. If no args: call PinnedBoardManager.post_or_update()
3. If args == "hide": call PinnedBoardManager.unpin()
4. Respond with confirmation

Implementation:
```python
elif text.startswith("board"):
    parts = text.split()
    board_action = parts[1] if len(parts) > 1 else "show"

    if board_action == "hide":
        await _handle_maro_board_hide(channel, client)
    else:
        await _handle_maro_board_show(channel, client)
```

Response examples:
- Show: "ðŸ“‹ Board updated in this channel"
- Hide: "Board removed from this channel"
- No tracked issues: "No issues tracked. Use `/maro track SCRUM-123` first."
  </action>
  <verify>/maro board posts a pinned message</verify>
  <done>Board command posts/updates pinned dashboard</done>
</task>

<task type="auto">
  <name>Task 3: Auto-refresh board on status changes</name>
  <files>src/slack/channel_tracker.py, src/slack/pinned_board.py</files>
  <action>
Hook board refresh into tracker updates:

1. In ChannelIssueTracker.update_sync_status():
   - After updating status, check if board exists for channel
   - If yes, trigger board refresh (async, non-blocking)

2. In ChannelIssueTracker.track() and untrack():
   - After adding/removing issue, refresh board if exists

3. Add method to PinnedBoardManager:
   - refresh_if_exists(client, channel_id) -> bool
   - Only updates if board_message_ts is set for channel

This ensures board stays current without manual /maro board calls.

Rate limit: Max 1 refresh per 30 seconds per channel (store last_refresh_at).
  </action>
  <verify>Track a new issue, board auto-updates</verify>
  <done>Board auto-refreshes on track/untrack/status changes</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `python -c "from src.slack.pinned_board import PinnedBoardManager"` works
- [ ] /maro board posts a message with tracked issues
- [ ] Board message gets pinned automatically
- [ ] /maro board hide removes the pinned message
- [ ] Tracking a new issue triggers board refresh
</verification>

<success_criteria>

- All tasks completed
- PinnedBoardManager creates/updates/removes board
- /maro board and /maro board hide work
- Board auto-refreshes on changes
</success_criteria>

<output>
After completion, create `.planning/phases/21-jira-sync/21-02-SUMMARY.md`
</output>
